---
import Layout from "../components/Layout.astro";
import menuData from "../content/menu.json";

// Helper to find the object containing the full menu categories
const fullMenu = menuData.find((item) => "micheladas" in item) as any;

if (!fullMenu) {
  throw new Error("Estructura de datos del menú incorrecta");
}

const categories = [
  { id: "micheladas", label: "Micheladas", data: fullMenu.micheladas },
  { id: "especiales", label: "Especiales", data: fullMenu.especiales },
  { id: "cervezas", label: "Cervezas", data: fullMenu.cervezas },
  { id: "caguamas", label: "Caguamas", data: fullMenu.caguamas },
  { id: "mixes", label: "Mixes", data: fullMenu.mixes },
  { id: "sin-alcohol", label: "Sin Alcohol", data: fullMenu.bebidasSinAlcohol },
  { id: "cider", label: "Cider", data: fullMenu.cider },
  { id: "preparados", label: "Preparados", data: fullMenu.preparados },
];

const promos = {
  domingo: "Sin promos activas",
  lunes: "Miche LTS $75 / Carta Blanca $75",
  martes: "Cubeta $140 / 2 Caguamas $140",
  miercoles: "2 Caguamas $140 / 4 Cervezas $140",
  jueves: "Miche LTS $70 / Cubeta $150",
  viernes: "Miche LTS 3x2",
  sabado: "Sin promos activas",
};

const weekdayMap = [
  "domingo",
  "lunes",
  "martes",
  "miercoles",
  "jueves",
  "viernes",
  "sabado",
] as const;

const hoyIdx = new Date().getDay();
const hoy = weekdayMap[hoyIdx];
const promoHoy = promos[hoy];
---

<Layout>
  <!-- Hero Section -->
  <div class="relative pt-32 pb-20 lg:pt-40 lg:pb-28 overflow-hidden">
    <div
      class="absolute inset-0 bg-brand/5 radial-gradient pointer-events-none"
    >
    </div>
    <div class="container mx-auto px-4 relative z-10 text-center">
      <h1
        class="text-6xl md:text-8xl font-serif font-bold text-white mb-6 tracking-tighter leading-none"
      >
        NUESTRO <span
          class="text-transparent bg-clip-text bg-gradient-to-r from-brand to-brand-dark"
          >MENÚ</span
        >
      </h1>
      <p class="text-gray-400 text-lg md:text-xl max-w-2xl mx-auto font-light">
        Explora nuestra selección premium de bebidas, cervezas y snacks
        diseñados para elevar tu noche.
      </p>
    </div>
  </div>

  <!-- Sticky Category Nav -->
  <div
    class="sticky top-28 z-40 bg-bg/80 backdrop-blur-xl border-y border-white/5 py-4 mb-16"
  >
    <div class="container mx-auto px-4 overflow-x-auto no-scrollbar">
      <div class="flex space-x-8 min-w-max justify-start md:justify-center">
        {
          categories.map((cat) => (
            <a
              href={`#${cat.id}`}
              class="text-sm md:text-base font-bold uppercase tracking-widest text-gray-500 hover:text-brand hover:scale-105 transition-all duration-300 whitespace-nowrap"
            >
              {cat.label}
            </a>
          ))
        }
      </div>
    </div>
  </div>

  <div class="container mx-auto px-4 pb-32 space-y-32">
    <!-- Promo Section -->
    {
      promoHoy && (
        <div class="relative overflow-hidden rounded-3xl bg-neutral-900 border border-white/10 p-8 md:p-12 text-center group">
          <div class="absolute inset-0 bg-gradient-to-r from-brand/10 to-transparent opacity-50 group-hover:opacity-100 transition-opacity duration-500" />
          <div class="relative z-10">
            <span class="inline-block py-1 px-3 rounded-full bg-brand/20 text-brand text-xs font-bold uppercase tracking-widest mb-4">
              Promo del Día ({hoy})
            </span>
            <h3 class="text-3xl md:text-5xl font-serif font-bold text-white">
              {promoHoy}
            </h3>
          </div>
        </div>
      )
    }

    <!-- Menu Categories -->
    {
      categories.map((cat) => (
        <section id={cat.id} class="scroll-mt-48">
          <div class="flex items-end gap-4 mb-12">
            <h2 class="text-5xl md:text-6xl font-serif font-bold text-white opacity-90">
              {cat.label}
            </h2>
            <div class="h-px flex-1 bg-gradient-to-r from-brand/50 to-transparent mb-4" />
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-12 gap-y-12">
            {cat.data?.map((item: any) => (
              <div class="group relative">
                <div class="flex justify-between items-baseline mb-2">
                  <h3 class="text-2xl font-bold text-white group-hover:text-brand transition-colors duration-300">
                    {item.name}
                  </h3>
                  <div class="flex-1 mx-4 border-b border-dotted border-white/20 relative top-[-6px]" />

                  {/* Price Logic */}
                  <div class="text-right shrink-0">
                    {item.price && (
                      <span class="text-2xl font-bold text-brand">
                        ${item.price}
                      </span>
                    )}

                    {/* 500ml / 1L logic */}
                    {(item["500"] || item["1000"]) && (
                      <div class="flex flex-col items-end text-lg gap-0.5">
                        {item["500"] && item["500"] !== "N/A" && (
                          <span class="text-gray-300 font-medium">
                            <span class="text-xs text-gray-500 mr-1 uppercase tracking-wide">
                              500ml
                            </span>
                            ${item["500"]}
                          </span>
                        )}
                        {item["1000"] && item["1000"] !== "N/A" && (
                          <span class="text-brand font-bold">
                            <span class="text-xs text-brand/70 mr-1 uppercase tracking-wide">
                              1L
                            </span>
                            ${item["1000"]}
                          </span>
                        )}
                      </div>
                    )}

                    {/* Cubeta / Pz logic */}
                    {(item.pz || item.cubeta) && (
                      <div class="flex flex-col items-end text-lg gap-0.5">
                        {item.pz && (
                          <span class="text-gray-300 font-medium">
                            <span class="text-xs text-gray-500 mr-1 uppercase tracking-wide">
                              Pz
                            </span>
                            ${item.pz}
                          </span>
                        )}
                        {item.cubeta && (
                          <span class="text-brand font-bold">
                            <span class="text-xs text-brand/70 mr-1 uppercase tracking-wide">
                              Cubeta
                            </span>
                            ${item.cubeta}
                          </span>
                        )}
                      </div>
                    )}

                    {/* Preparados logic */}
                    {(item.ch || item.g) && (
                      <div class="flex flex-col items-end text-lg gap-0.5">
                        {item.ch && (
                          <span class="text-gray-300 font-medium">
                            <span class="text-xs text-gray-500 mr-1 uppercase tracking-wide">
                              CH
                            </span>
                            ${item.ch}
                          </span>
                        )}
                        {item.g && (
                          <span class="text-brand font-bold">
                            <span class="text-xs text-brand/70 mr-1 uppercase tracking-wide">
                              G
                            </span>
                            ${item.g}
                          </span>
                        )}
                      </div>
                    )}
                  </div>
                </div>
                <p class="text-base text-gray-500 font-light tracking-wide group-hover:text-gray-400 transition-colors">
                  {cat.id === "micheladas"
                    ? "Preparada con nuestras salsas especiales."
                    : cat.id === "mixes"
                      ? "Mezcla refrescante y única."
                      : ""}
                </p>
              </div>
            ))}
          </div>
        </section>
      ))
    }

    {
      fullMenu.nota && (
        <div class="text-center py-8 border-t border-white/10">
          <p class="text-gray-500 italic text-sm">{fullMenu.nota}</p>
        </div>
      )
    }
  </div>
</Layout>

<style>
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .radial-gradient {
    background: radial-gradient(
      circle at center,
      rgba(0, 207, 106, 0.1) 0%,
      rgba(11, 11, 11, 0) 70%
    );
  }
</style>
