---
const { items = [] } = Astro.props;
---

<section id="promos" class="py-10 bg-black/20">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-3xl md:text-4xl font-bold text-white">
        Promociones <span class="text-brand">Del DÃ­a</span>
      </h2>
      <!-- <span class="hidden md:block text-sm text-gray-500">
        Autoplay activo
      </span> -->
    </div>

    <!-- Carrusel -->
    <div
      id="promo-carousel"
      class="flex gap-6 overflow-x-auto scroll-smooth snap-x snap-mandatory scrollbar-hide pb-4"
    >
      {
        items.map((item: any) => (
          <div
            class="min-w-[85%] sm:min-w-[45%] lg:min-w-[30%] snap-start
                   relative rounded-2xl overflow-hidden shadow-xl bg-black"
          >
            <!-- Imagen -->
            <div class="h-56 flex items-center justify-center bg-black">
              <img
                src={item.image}
                alt={item.title}
                class="max-h-full max-w-full object-contain"
              />
            </div>

            <!-- Overlay -->
            <div class="absolute inset-0 bg-linear-to-t from-black/90 via-black/40 to-transparent"></div>

            <!-- Texto -->
            <div class="absolute bottom-0 left-0 p-5 w-full">
              <span class="inline-block px-3 py-1 bg-brand text-black text-xs font-bold uppercase rounded-full mb-2">
                Oferta limitada
              </span>
              <h3 class="text-xl font-bold text-white">
                {item.title}
              </h3>
              <p class="text-lg text-brand font-medium">
                {item.subtitle}
              </p>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<!-- Autoplay -->
<script>
  const carousel = document.getElementById('promo-carousel');
  let autoScroll: any;
  let isHovering = false;

  const startAutoplay = () => {
    if (!carousel) return;
    
    autoScroll = setInterval(() => {
      if (!isHovering && carousel) {
        carousel.scrollBy({
          left: carousel.clientWidth,
          behavior: 'smooth'
        });

        // Reinicio cuando llega al final
        if (
          (carousel.scrollLeft ?? 0) + carousel.clientWidth >=
          (carousel.scrollWidth ?? 0) - 10
        ) {
          setTimeout(() => {
            carousel?.scrollTo({ left: 0, behavior: 'smooth' });
          }, 1200);
        }
      }
    }, 3500);
  };

  const stopAutoplay = () => clearInterval(autoScroll);

  if (carousel) {
    carousel.addEventListener('mouseenter', () => (isHovering = true));
    carousel.addEventListener('mouseleave', () => (isHovering = false));
    carousel.addEventListener('touchstart', stopAutoplay, { passive: true });
    startAutoplay();
  }
</script>

<style>
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>